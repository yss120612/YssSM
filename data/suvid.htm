<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Система автоматики Yss</title>
    <meta name="description" content="Версия 0.1">
    <meta name="author" content="Yss">
    <link href="/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/highstock.js"></script>
	<script type="text/javascript" src="/js/exporting.js"></script>
	<script type="text/javascript" src="/js/export-data.js"></script>
</head>
<body>
	<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<a href="/" class="btn btn-info">Дом</a>
		</div>
		<div class="col-md-12">
			<button class="btn btn-info" id="button">qqq</button>
		</div>
		
		<div class="col-md-12">
			<button class="btn btn-info" id="button1">qqq1</button>
		</div>
		
		<div class="col-md-offset-1 col-md-10">
		<h3>Сувид</h3>
		</div>
	
		<div class="col-md-offset-1 col-md-10">
			<div id="TTARGET"></div>		
		</div>
		<div class="col-md-offset-1 col-md-10">
			<div id="TIMELEFT"></div>		
		</div>
		
		<div class="col-md-offset-1 col-md-10">
			<div id="TKUBE"></div>		
		</div>
		<div class="col-md-offset-1 col-md-10">
			<div id="TTRIAK"></div>		
		</div>
		<div class="col-md-offset-1 col-md-10">
			<div id="HPOWER"></div>		
		</div>
		
		<div class="col-md-offset-1 col-md-10">
			<div id="STA"></div>		
		</div>
		
		<div class="col-md-offset-1 col-md-10">
			<div id="CHART"></div>		
		</div>
	</div>
	</div>
 
 <script type="text/javascript">
	$(document).ready(function(){
	process();
	
	Highcharts.setOptions({
	global:
	{
		useUTC: false
	}
	});

	 var chart1 = new Highcharts.Chart({
	title: {
		text: 'SuVid'
	},
	subtitle: {
		text: 'История изменения температуры в кубе и мощности тэна.'
	},
	yAxis:[{
	
	title: {
        text: 'Температура'
		},
		 plotLines: [{
                value: 60,
                color: 'green',
				id: 'tmp',
                dashStyle: 'shortdash',
                width: 1,
                label: {
                    text: 'Заданная температура'
                }
            }],
		 labels: {
			formatter: function() {
            return this.value + '°C'
			}
		 }
		},{
		title: {
        text: 'Мощность'
		},
    
		 labels: {
			formatter: function() {
            return this.value + '%'
			}
		 },
		 opposite: true
		}],
        xAxis: {
            type: 'datetime'
        },	
        chart: {
            renderTo: 'CHART',
			type: 'spline', 
			 events: {
            load: function () {
			
			 var series0 = this.series[0];
			 var series1 = this.series[1];
			 var ax = this.yAxis[0];
			 
			setInterval(function(){
			$.getJSON("/suvidchart", function(lst) {
			var shift = series0.data.length > 120;
			//int x=(new Date()).getTime();
			var y0= parseFloat(lst['kube_data']);
			var y1= parseFloat(lst['heater_data']);
			ax.removePlotLine('tmp');
			ax.addPlotLine({
				value: parseFloat(lst['ttarget_data']),
                color: 'green',
				id: 'tmp',
                dashStyle: 'shortdash',
                width: 1,
                label: {
                    text: 'Заданная температура'
                }
        });
			//alert(y);
		    //this.series[0].addPoint([x,y], true, false); 
			//alert('here');
			
			//series.addPoint([(new Date()).getTime(),y],true,shift); 
			//series0.addPoint(y0,true,shift); 
			//series1.addPoint(y1,true,shift); 
			series0.addPoint(randomInteger(0,100),true,shift); 
			series1.addPoint(randomInteger(0,100),true,shift); 
			});
			}, 10000);
            }
        }
        },
	

		
		
        series: [{
			name:'Температура',
            data: [20],
            pointStart: (new Date()).getTime()-10000,
           // pointInterval: 10 * 1000
        },{
			name:'Мощность тэна',
            data: [40],
			color: '#FF0000',
            pointStart: (new Date()).getTime()-10000,
		}]
    });
	
	
	
	$('#button1').click(function () {
    
	 chart1.update({
        xAxis: {
           plotLines: [{
                value: 30
				}]
        }
    });
   });
   
	$('#button').click(function () {
    //chart1.xAxis.plotLines[0].value=80;
	 chart1.yAxis[0].removePlotLine('tmp');
	 chart1.yAxis[0].addPlotLine({
				value: 20,
                color: 'green',
				id: 'tmp',
                dashStyle: 'shortdash',
                width: 1,
                label: {
                    text: 'Заданная температура'
                }
        });
	//alert('click');
   });
	
	
	});
	
	function randomInteger(min, max) {
    var rand = min - 0.5 + Math.random() * (max - min + 1)
    rand = Math.round(rand);
    return rand;
  }
	function load() {
			  
    $.getJSON("/suvidchart", function(lst) {
			
			//int x=(new Date()).getTime();
			//var y= parseFloat(lst['kube_data']);
			//alert(y);
		    //this.series[0].addPoint([x,y], true, false); 
			//alert('here');
			//alert(this.title.text+' this');
			//alert(chart1.title.text+ ' chart1');
			//this.series[0].addPoint(30); 
	  });
	};
		
	function process(){
		$.getJSON(
		"/suviddata",
		function(data){
		$('#TTARGET').html('Температура поддерживаемая <b>'+data['ttarget_data']+'&deg;C</b>');
		$('#TKUBE').html('Температура в кубе <b>'+data['kube_data']+'&deg;C</b>');
		$('#TTRIAK').html('Температура радиатора нагревателя <b>'+data['cooler_data']+'&deg;C</b>');
		$('#HPOWER').html('Мощность нагревателя <b>'+data['heater_data']+'%</b>');
		$('#TIMELEFT').html('Осталось <b>'+data['time_data']+'</b>');
		$('#STA').html('Состояние <b>'+data['state_data']+'</b>');
		});
		setTimeout('process()',3000);
	};

	
	



	</script>
	</body>
</html>